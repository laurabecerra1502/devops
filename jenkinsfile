@Library('SonarQube') _

pipeline {
    agent any
    stages {
        stage('Checkout') {
            steps {
                script {
                    sonarqube.checkout(branch: "master", gitrepo: "https://github.com/laurabecerra1502/aplicacion-webpage.git")
                }
            }
        }

        stage('scan') {
            steps {
                script {
                    sonarqube.scan(scannerhome: "sonarqube")
                }
            }
        }

        stage("scan2") {
            steps {     
                withSonarQubeEnv('sonarqube') {
                    sh "${scannerHome}/bin/sonar-scanner \
                        -Dsonar.projectKey=labreto1 \
                        -Dsonar.projectName=labreto1 \
                        -Dsonar.projectVersion=1.0 \
                        -Dsonar.sources=/var/jenkins_home/workspace/estasies \
                        -Dsonar.host.url=http://sonarqube:9000 \
                        -Dsonar.login=admin \
                        -Dsonar.password=1234 "
                }
            }        
        }        
    }
}
